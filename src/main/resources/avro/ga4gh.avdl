@namespace("org.ga4gh")
protocol GA4GH {

record GAReferenceSequence {
  union { null, string } assemblyId = null;
  union { null, long } length = null;
  union { null, string } md5checksum = null;
  union { null, string } name = null;
  union { null, string } species = null;
  union { null, string } uri = null;
}

record GAReadGroup {
  union { null, string } date = null;
  union { null, string } description = null;
  union { null, string } flowOrder = null;
  union { null, string } id = null;
  union { null, string } keySequence = null;
  union { null, string } library = null;
  union { null, string } platformUnit = null;
  union { null, int } predictedInsertSize = null;
  union { null, string } processingProgram;
  union { null, string } sample;
  union { null, string } sequencingCenter;
  union { null, string } sequencingTechnology;
}

record GAProgram {
  union { null, string } commandLine = null;
  union { null, string } id = null;
  union { null, string } name = null;
  union { null, string } prevProgramId = null;
  union { null, string } version = null;
}

record GADataSet {
    string id;
    union { null, string } description = null;
}

record GAReadSet {

  // The readset ID.
  union {null, string} id = null;

  // The readset name.
  union {null, string} name = null;

  // The ID of the dataset this readset belongs to.
  union {null, string} datasetId = null;

  // The date this readset was created.
  union {null, long} created = null;

  // The number of reads in this readset.
  union {null, long} readCount = null;
  
  // One-line text comments
  union { null, array<string> } comments = null;

  // (@PG) programs
  union { null, array<GAProgram> } programs = null;

  // (@RG) read group
  union { null, array<GAReadGroup> } readGroups = null;

  // (@SQ) Reference Sequence Dictionary
  union { null, array<GAReferenceSequence> } referenceSequences = null;
}

record GAKeyValue { 
    string key;
    string value = null;
}

enum GACigarOperation {
    ALIGNMENT_MATCH,   // M
    INSERT,            // I
    DELETE,            // D
    SKIP,              // N
    CLIP_SOFT,         // S
    CLIP_HARD,         // H
    PAD,               // P
    SEQUENCE_MATCH,    // =
    SEQUENCE_MISMATCH  // X
}

record GACigarUnit {
    GACigarOperation operation;
    long operationLength;

    // contigSequence is only used at mismatches (X) and deletions (D). Filling
    // this field replaces the MD tag. If the relevant information is not
    // available, leave this field as "null".
    union { null, string } contigSequence = null;
}

record GALinearAlignment { // a linear alignment can be represented by one CIGAR string
    string contigName;
    long position; // 0-based position
    boolean reverseStrand; // the alignment is on the reverse strand of the reference sequence.
    union { null, int } mappingQuality = null;
    array<GACigarUnit> cigar = []; 
    array<GAKeyValue> tags = [];
}

record GARead {
    // This read failed quality control (SAM flag 0x200)
    union { boolean, null } failedVendorQualityChecks = false;

    // The alignment of this read. If unmapped, the array is empty. If the
    // alignment is linear (vast majority of alignments), the array is of size
    // one. If the alignment is composed of multiple simple linear alignments
    // (i.e. chimeric), the components can be found in the SA tag for mappers
    // supporting the feature.
    array<GALinearAlignment> alignment = [];

    // The list of bases that this read represents (e.g. 'CATCGA'). (SEQ)
    union { null, string } baseSequence = null;

    // Represents the quality of each base in this read. Each character represents
    // one base. To get the quality, take the ASCII value of the character and
    // subtract 33. (QUAL)
    union { null, string } baseQuality = null;

    array<GAKeyValue> tags = [];
}

record GAFragment {
    // The ID of the ReadGroup this fragment belongs to. (Every fragment must belong to exactly one ReadGroup.)
    string readGroupId;

	// The fragment is suppposed to be free of strucutral variations. For
	// paired-end reads, this flag is reduced to the "properly paired" SAM flag
	// (bit 0x2). It is typically set by the mapper to inform downstream tools.
	union { boolean, null } properPlacement = false;

	// This fragment is a PCR or optical duplicate (SAM flag 0x400)
    union { boolean, null } duplicateFragment = false;

	// Reads sequenced from this fragment. The array order is the sequencing order.
	array<GARead> reads;

    // Length of the original piece of dna that produced both this read and the
    // paired read. (TLEN)
    union { null, int } templateLength = null; 
}

}
